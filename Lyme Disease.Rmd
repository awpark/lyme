---
title: "Lyme Disease"
author: "Jenna Lea"
date: "May 16, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#PRISM uses image-based file storage, which means we need to work with two file types:

#`bil` files (band interleaved by lines)
#`hdr` files (associated header file)

##Minimum Temperatures

```{r}
filenames<-list.files("./data/PRISM/min_temp")
filenames<-filenames[grep(".*\\.bil$",filenames)]
filenames<-gsub("PRISM","\\./data/PRISM/min_temp/PRISM",filenames)

require(maptools)
require(raster)

mean2<-function(x){return(mean(x,na.rm=T))}
US_Counties<-readShapePoly("./data/US/US_County_2000_2004_geo")
US_Counties_Polygons<-as(US_Counties,"SpatialPolygons")

#MinTemp
r<-raster(filenames[1])
z<-raster::extract(r,US_Counties_Polygons)
min_temp<-as.data.frame(cbind(rep(2000,length(US_Counties$FIPSNum)),US_Counties$FIPSNum,unlist(lapply(z,mean2))))
names(min_temp)<-c("year","fips","av")

for (i in 2:16){
  m<-raster(filenames[i])
  this.year<-i+1999
  n<-raster::extract(m,US_Counties_Polygons)
  tmp1<-as.data.frame(cbind(rep(this.year,length(US_Counties$FIPSNum)),US_Counties$FIPSNum,unlist(lapply(n,mean2))))
  names(min_temp)<-c("year","fips","av")
  MinTemp<-rbind(min_temp,tmp1)
}
```

##Maximum Temperatures
```{r}
filenames<-list.files("./data/PRISM/max_temp")
filenames<-filenames[grep(".*\\.bil$",filenames)]
filenames<-gsub("PRISM","\\./data/PRISM/max_temp/PRISM",filenames)


mean2<-function(x){return(mean(x,na.rm=T))}
US_Counties<-readShapePoly("./data/US/US_County_2000_2004_geo")
US_Counties_Polygons<-as(US_Counties,"SpatialPolygons")

#MaxTemp
a<-raster(filenames[1])
x<-raster::extract(a,US_Counties_Polygons)
max_temp<-as.data.frame(cbind(rep(2000,length(US_Counties$FIPSNum)),US_Counties$FIPSNum,unlist(lapply(x,mean2))))
names(max_temp)<-c("year","fips","av")

for (i in 2:16){
  a<-raster(filenames[i])
  this.year<-i+1999
  x<-raster::extract(a,US_Counties_Polygons)
  tmp2<-as.data.frame(cbind(rep(this.year,length(US_Counties$FIPSNum)),US_Counties$FIPSNum,unlist(lapply(x,mean2))))
  names(max_temp)<-c("year","fips","av")
  MaxTemp<-rbind(max_temp,tmp2)
}

```


